function getDimensions(e){var t={dimension1:e.section.name_eng,dimension2:e.subsection?e.subsection.name_eng:"",dimension13:e.tags?e.tags.map(function(e){return e.name}).join(";"):"",dimension14:e.publish_date.split(" ")[0].replace(/-/g,"/"),dimension15:e.creator?e.creator:""};return e.blogger?t.dimension11=e.blogger.name:t.dimension11=e.author?e.author:"",t}Vue.use(Vuex);var store=new Vuex.Store({state:{isMobile:App.isMobile,isLoggedIn:"true"===JSON.parse(JSON.stringify(INITIAL_STATE.isLoggedIn)),firstArticle:JSON.parse(JSON.stringify(INITIAL_STATE.article)),articles:[],activeIndex:-1,preview:JSON.parse(JSON.stringify(INITIAL_STATE.preview)),pendingArticles:JSON.parse(JSON.stringify(INITIAL_STATE.pendingArticles)),loadingArticle:!1,galleryData:{images:[],options:{}},dfp:JSON.parse(JSON.stringify(INITIAL_STATE.dfp)),fabVisible:!1,progressBarVisible:!1,openAppLinkVisible:!0,progress:0,isBlogger:INITIAL_STATE.isBlogger},mutations:{SET_ACTIVE_INDEX:function(e,t){e.activeIndex=t},ADD_ARTICLE:function(e,t){e.articles.push(t)},POP_PENDING_ARTICLES:function(e){e.pendingArticles.shift()},SET_ARTICLE_LOADING:function(e,t){e.loadingArticle=t},SET_ARTICLE_VIEWED:function(e,t){-1==t.index?e.firstArticle.viewed=!0:e.articles[t.index].viewed=!0},SET_FAB_VISIBLE:function(e,t){e.fabVisible=t},SET_PROGRESSBAR_VISIBLE:function(e,t){e.progressBarVisible=t},SET_OPEN_APP_VISIBLE:function(e,t){e.openAppLinkVisible=t},SET_PROGRESS:function(e,t){e.progress=t},SET_BOOKMARK:function(e,t){e.articles[t.index].bookmark=t.bookmark},SET_GALLERY_DATA:function(e,t){e.galleryData=t}},getters:{isLoggedIn:function(e){return e.isLoggedIn},article:function(e){return function(t){return-1==t?e.firstArticle:e.articles[t]}},articles:function(e){return e.articles},activeArticle:function(e){return-1==e.activeIndex?e.firstArticle:e.articles[e.activeIndex]},preview:function(e){return e.preview},activeIndex:function(e){return e.activeIndex},pendingArticles:function(e){return e.pendingArticles},nextArticleToLoad:function(e){return e.pendingArticles[0]},isArticleLoading:function(e){return e.loadingArticle},dfp:function(e){return e.dfp},fabVisible:function(e){return e.fabVisible},progressBarVisible:function(e){return e.progressBarVisible},progress:function(e){return e.progress},isBlogger:function(e){return e.isBlogger}},actions:{LOAD_ARTICLE:function(e,t){e.commit("SET_ARTICLE_LOADING",!0),$.ajax({method:"GET",url:(e.getters.isBlogger?"column/":"article/")+e.getters.nextArticleToLoad.id+"/ajax",dataType:"json"}).done(function(i){e.commit("POP_PENDING_ARTICLES"),i.article.next=e.getters.nextArticleToLoad,i.article.shouldScrollOnLoaded=t.shouldScrollOnLoaded,e.commit("ADD_ARTICLE",i.article)}).fail(function(){}).always(function(){e.commit("SET_ARTICLE_LOADING",!1)})},SET_FAB_VISIBLE:function(e,t){t.index===e.getters.activeIndex&&e.commit("SET_FAB_VISIBLE",t.visible)},SET_PROGRESSBAR_VISIBLE:function(e,t){t.index===e.getters.activeIndex&&e.commit("SET_PROGRESSBAR_VISIBLE",t.visible)},SET_PROGRESS:function(e,t){t.index===e.getters.activeIndex&&e.commit("SET_PROGRESS",t.progress)},TOGGLE_BOOKMARK:function(e,t){e.commit("SET_BOOKMARK",{index:t,bookmark:"1"===e.getters.article(t).bookmark?"0":"1"})}}});new Vue({el:"#v-app",store:store,mixins:[relatedArticleMixin,articleWrapperMixin,recommendedArticleLinkMixin],data:{infinityThreshold:4,titleSuffix:" - U Beauty 美容網站",isShowRewardDrawer:!0,sideAreaStickState:"none",yOffset:{top:0,bottom:0},active:!1,runnable:null,scrollProgress:0,shouldShowProgress:!1,index:-1,images:[],contents:null,currentFragmentIndex:-1,fragmentComscoreStateList:[],isGoogleTagSent:!1},computed:{article:function(){return this.$store.state.firstArticle},articles:function(){return this.$store.getters.articles},activeArticle:function(){return this.$store.getters.activeArticle},getClass:function(){switch(this.sideAreaStickState){case"top":return"stay";case"bottom":return"remove";default:return""}},getStyle:function(){return"top"===this.sideAreaStickState?"top: 75px":""},dfpMeta:function(){return this.$store.getters.dfp},isActive:function(){return this.index===this.$store.getters.activeIndex}},methods:{setActive:function(e){this.$store.commit("SET_ACTIVE_INDEX",e),this.setUrl(this.activeArticle.url),document.title=(this.activeArticle.meta_title||this.activeArticle.title)+this.titleSuffix,this.activeArticle.viewed||(this.$store.commit("SET_ARTICLE_VIEWED",{index:e}),this.sendGAEvent(e))},setFragmentActive:function(e,t){this.$store.getters.activeIndex===e&&this.setUrl(this.$store.getters.activeArticle.url+(t>0?"/"+(t+1):""))},scrollToArticle:function(e){$("html, body").animate({scrollTop:$(this.$refs[e][0].$el).offset().top-$("#global-menu").height()-1},500,function(){this.setActive(e)}.bind(this))},setUrl:function(e){this.$store.getters.preview||window.history.replaceState(null,null,e+location.search)},getTagNames:function(e){return e.map(function(e){return e.name})},sendGAEvent:function(e){if(!this.$store.getters.preview){var t=getDimensions(this.activeArticle);ga("set",t);var i=this.activeArticle.url.substr(App.getBaseUrl().length)+(-1===e?"":"?ref=scroll");ga("send","pageview",i,{title:this.activeArticle.title+this.titleSuffix})}},getNextArticle:function(e){this.$store.getters.isArticleLoading||(this.$store.getters.pendingArticles.length>0&&this.$store.getters.activeIndex>=this.articles.length-1?this.$store.dispatch("LOAD_ARTICLE",{id:this.$store.getters.nextArticleToLoad.id,shouldScrollOnLoaded:e}):this.scrollToArticle(this.$store.getters.activeIndex+1))},goTo:function(e,t,i){i=i;ga("send","event",{eventCategory:"Detail Page Links",eventAction:i?"Latest Popular Article":"Latest Article"+(e+1),hitCallback:function(){location.href=t},hitCallbackFail:function(){location.href=t}})},sendSocialEvent:function(e){ga("send","event",{eventCategory:"Detail Page Links",eventAction:e,eventLabel:window.location.href})},setIsActive:function(){clearTimeout(this.runnable),this.runnable=setTimeout(function(){this.active="mobile"===App.UBBannerSwap.getCurrentBreakPoint().name}.bind(this),250)},init:function(){!this.isGoogleTagSent&&this.runnable&&(googletag.cmd.push(function(){var e=[this.activeArticle.section.name_chi];this.activeArticle.subsection&&e.push(this.activeArticle.subsection.name_chi);var t=[[1,1],[300,250],[300,100]],i=googletag.defineSlot("/183518426/UBeauty2_WebRP_BeautyDetail_MobileInArticle",t,"flying-carpet").defineSizeMapping(googletag.sizeMapping().addSize([0,0],t).build()).addService(googletag.pubads()).setTargeting("article_id",this.activeArticle.id).setTargeting("section",e);if(this.activeArticle.formal_tags){var n=[];this.activeArticle.formal_tags.forEach(function(e){n=n.concat(e.name.split(/[,-]/))}),i.setTargeting("formal_tag",n)}this.activeArticle.content_targeting&&i.setTargeting("keyword",this.activeArticle.content_targeting.split(/,/)),googletag.display("flying-carpet")}.bind(this)),this.isGoogleTagSent=!0)},handleFragmentScrollState:function(e,t){var i=e.getBoundingClientRect();this.currentFragmentIndex!==t&&i.top<this.yOffset.top&&i.height+i.top>this.yOffset.top&&(this.currentFragmentIndex=t,this.setFragmentActive(this.index,this.currentFragmentIndex),this.sendComScoreEvent(this.currentFragmentIndex))},handleScroll:function(){var e=this.$refs.container.getBoundingClientRect();Math.abs(e.top)<e.height-$("#global-menu").height()&&(0===Number.parseInt(this.activeArticle.is_app_exclusive)&&this.handleContentScrollState(),-1!==this.$store.getters.activeIndex&&this.$store.getters.activeArticle&&(this.$store.commit("SET_ACTIVE_INDEX",-1),this.setUrl(this.activeArticle.url),document.title=(this.activeArticle.meta_title||this.activeArticle.title)+this.titleSuffix))},processContentImages:function(e){var t=this.activeArticle.cover;e.forEach(function(e){e.querySelectorAll("img:not(.article-gallery__image):not(.no-enlarge)").forEach(function(e){"A"!==e.parentElement.tagName&&new EnlargeWrapper({propsData:{rawHtml:e.outerHTML},el:e}),t||(t=!0,this.$emit("on-replacement-cover-found",e.src))}.bind(this))}.bind(this))},parsePhotoGallery:function(e,t){e.querySelectorAll("ul").forEach(function(e){var t=[],i=e.querySelectorAll("li img");i.length>0&&(i.forEach(function(e){t.push({src:e.src,title:e.title,alt:e.alt,w:0,h:0})}),new ArticleGallery({el:e,store:store,data:{article:this.activeArticle,images:t}}))}.bind(this))},overrideAnchorHash:function(e){var t=window.location.href.split("#")[0];e.querySelectorAll('a[href^="#"]').forEach(function(e){e.setAttribute("href",t+e.getAttribute("href"))})},overrideRelatedArticleLink:function(e){e.querySelectorAll(".u-related-article__link").forEach(function(e){var t=e.innerHTML;new RecommendedArticleLink({propsData:{rawHtml:t},el:e})})},overrideContents:function(e){var t=this.activeArticle.author;e.forEach(function(e){this.parsePhotoGallery(e,t),this.overrideAnchorHash(e),this.overrideRelatedArticleLink(e)}.bind(this))},prepareGalleryImages:function(){var e=this;this.$refs.container.querySelectorAll(".wrapper-a img, .article-fragment .content-image-wrapper img:not(.article-gallery__image):not(.no-enlarge)").forEach(function(t){var i=t.getAttribute("src"),n=!1;for(var r in e.images)if(r.src===i){n=!0;break}n||e.images.push({src:i,title:t.title,w:0,h:0})}),$(this.$refs.container).on("click",".wrapper-a img",function(){e.openGallery($(this).attr("src"))}),$(this.$refs.container).on("click",".article-fragment .content-image-wrapper",function(){e.openGallery($(this).find("img").attr("src"))})},openGallery:function(e){for(var t=-1,i=0,n=this.images.length;i<n;i++)if(this.images[i].src===e){t=i;break}this.$store.commit("SET_GALLERY_DATA",{images:this.images,options:{index:t},article:this.activeArticle})},setReplacementCover:function(e){var t=new Image;t.onload=function(){t.width>=400&&t.height>=400&&(this.replacementCover=e,this.images.splice(0,1))}.bind(this),t.src=e},handleBanners:function(){"undefined"!=typeof googletag&&googletag.cmd.push(function(){for(var e=[],t=1;t<this.dfpMeta.length;t++)if(-1===this.dfpMeta[t].slot.indexOf("lightboxtop")){var i,n=JSON.parse(this.dfpMeta[t].sizeSet),r=[this.activeArticle.section.name_chi];this.activeArticle.subsection&&r.push(this.activeArticle.subsection.name_chi);var s=googletag.sizeMapping();if(this.dfpMeta[t].mapping)for(var a=1;a<this.dfpMeta[t].mapping;a++){var o=this.dfpMeta[t].mapping[a];s.addSize(o.key,o.val)}else s.addSize([0,0],n);if(i=-1!==this.dfpMeta[t].slot.indexOf("special")?googletag.defineOutOfPageSlot(this.dfpMeta[t].slot,this.dfpMeta[t].zone+"-"+t+"-"+this.activeArticle.id).defineSizeMapping(s.build()).addService(googletag.pubads()).setTargeting("article_id",this.activeArticle.id).setTargeting("section",r):googletag.defineSlot(this.dfpMeta[t].slot,n,this.dfpMeta[t].zone+"-"+t+"-"+this.activeArticle.id).defineSizeMapping(s.build()).addService(googletag.pubads()).setTargeting("article_id",this.activeArticle.id).setTargeting("section",r),this.activeArticle.formal_tags){var c=[];this.activeArticle.formal_tags.forEach(function(e){c=c.concat(e.name.split(/[,-]/))}),i.setTargeting("formal_tag",c)}this.activeArticle.content_targeting&&i.setTargeting("keyword",this.activeArticle.content_targeting.split(/,/)),e.push(i),googletag.display(this.dfpMeta[t].zone+"-"+t+"-"+this.activeArticle.id)}this.index>0&&(App.UBBannerSwap.swapBannerAfterward(".contents-container__article[data-id="+this.activeArticle.id+"] .ad-zone-swapper"),googletag.pubads().refresh(e))}.bind(this))},getCarouselConfig:function(e,t){var i={items:e,nav:!0,mouseDrag:!0,touchDrag:!0};return t&&(i.margin=t),i},sendAppOnlyEvent:function(e){App.sendGAEvent("App Only Content Page",e,location.href)}},mounted:function(){var e=this.$refs.articleHeader;e&&(e.classList.add("animated","fadeInLeft-ub"),e.hidden=!1),this.setActive(-1),App.UBBannerSwap.run(),this.setIsActive(),1!==Number.parseInt(this.activeArticle.is_app_exclusive)&&(this.contents=document.querySelectorAll(".contentBody"),this.contents&&(this.overrideContents(this.contents),this.processContentImages(this.contents),0!==this.index&&App.VideoEmbed.run($(this.contents))),this.handleBanners(),this.prepareGalleryImages())},beforeMount:function(){window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.setIsActive)},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.setIsActive)},updated:function(){this.active&&this.init()},directives:{tag:{inserted:function(e){googletag.cmd.push(function(){googletag.defineSlot("/21807278789/ub_textlink_1",[1,1],e.value).addService(googletag.pubads()),googletag.display(this.id)}.bind(this))}},carousel:{inserted:function(e,t,i){var n=i.context.getCarouselConfig;$(e).owlCarousel({margin:15,nav:!0,dots:!1,smartSpeed:200,navText:['<i class="fa fa-angle-left fa-2x"></i>','<i class="fa fa-angle-right fa-2x"></i>'],responsive:{0:n(1,5),440:n(1,5),768:n(2),991:n(2,25),1200:n(2,25)}})}}}});